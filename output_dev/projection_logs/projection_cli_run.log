2025-05-15 22:22:22,620 [INFO    ] [cost_model.projections.cli.main:75] Starting projection run with CLI arguments: Namespace(config='config/dev_tiny.yaml', census='data/census_preprocessed.parquet', debug=False, output_dir=None, scenario_name='projection_cli')
2025-05-15 22:22:22,620 [INFO    ] [cost_model.projections.cli.main:79] Loading configuration from: config/dev_tiny.yaml
2025-05-15 22:22:22,620 [INFO    ] [cost_model.config.loaders.load_yaml_config:71] Attempting to load configuration from: config/dev_tiny.yaml
2025-05-15 22:22:22,628 [INFO    ] [cost_model.config.loaders.load_yaml_config:89] Successfully loaded configuration from config/dev_tiny.yaml
2025-05-15 22:22:22,633 [INFO    ] [cost_model.projections.cli.main:85] Logging level set to: DEBUG
2025-05-15 22:22:22,634 [INFO    ] [cost_model.projections.cli.main:95] Output will be saved to: output_dev/projection_cli_results
2025-05-15 22:22:22,634 [INFO    ] [cost_model.projections.cli.main:100] Creating initial snapshot from census: data/census_preprocessed.parquet for start year: 2025
2025-05-15 22:22:22,634 [INFO    ] [cost_model.projections.snapshot.create_initial_snapshot:24] Creating initial snapshot for start year: 2025 from data/census_preprocessed.parquet
2025-05-15 22:22:22,690 [INFO    ] [cost_model.projections.snapshot.create_initial_snapshot:34] Loaded census data with 150 records. Columns: ['employee_id', 'employee_role', 'employee_birth_date', 'employee_hire_date', 'employee_termination_date', 'employee_gross_compensation', 'employee_plan_year_compensation', 'employee_capped_compensation', 'employee_deferral_rate', 'employee_contribution', 'employer_core_contribution', 'employer_match_contribution']
2025-05-15 22:22:22,693 [INFO    ] [cost_model.projections.snapshot.create_initial_snapshot:49] Filtered out 50 employees terminated before or at 2025-01-01. Remaining: 100
2025-05-15 22:22:22,693 [INFO    ] [cost_model.projections.snapshot.create_initial_snapshot:61] Setting active status based on termination dates: 100 active out of 100
2025-05-15 22:22:22,695 [INFO    ] [cost_model.projections.snapshot.create_initial_snapshot:121] Inferring job levels from compensation data...
2025-05-15 22:22:22,699 [INFO    ] [cost_model.projections.snapshot.create_initial_snapshot:148] Inferred job levels: {np.int64(1): 57, np.int64(0): 18, np.int64(4): 16, np.int64(3): 7, np.int64(2): 2}
2025-05-15 22:22:22,699 [DEBUG   ] [cost_model.projections.snapshot.create_initial_snapshot:149] Job levels distribution: employee_level
1    57
0    18
4    16
3     7
2     2
Name: count, dtype: Int64
2025-05-15 22:22:22,699 [INFO    ] [cost_model.projections.snapshot.create_initial_snapshot:158] Using 'employee_role' column from census data
2025-05-15 22:22:22,704 [INFO    ] [cost_model.projections.snapshot.create_initial_snapshot:270] Initial snapshot created with 100 records. Columns: ['employee_id', 'employee_hire_date', 'employee_birth_date', 'employee_role', 'employee_gross_compensation', 'employee_termination_date', 'active', 'employee_deferral_rate', 'tenure_band', 'employee_tenure', 'employee_level', 'job_level_source', 'exited']
2025-05-15 22:22:22,704 [DEBUG   ] [cost_model.projections.snapshot.create_initial_snapshot:271] Initial snapshot dtypes:
employee_id                    string[python]
employee_hire_date             datetime64[ns]
employee_birth_date            datetime64[ns]
employee_role                  string[python]
employee_gross_compensation           Float64
employee_termination_date      datetime64[ns]
active                                boolean
employee_deferral_rate                Float64
tenure_band                    string[python]
employee_tenure                       float64
employee_level                          Int64
job_level_source                     category
exited                                boolean
dtype: object
2025-05-15 22:22:22,704 [INFO    ] [cost_model.projections.cli.main:104] Creating initial event log for start year: 2025
2025-05-15 22:22:22,705 [INFO    ] [cost_model.projections.event_log.create_initial_event_log:19] Creating initial event log for events up to start of year: 2025
2025-05-15 22:22:22,705 [DEBUG   ] [cost_model.projections.event_log.create_initial_event_log:32] Adding missing event log column: value_json with presumed dtype: string
2025-05-15 22:22:22,705 [DEBUG   ] [cost_model.projections.event_log.create_initial_event_log:32] Adding missing event log column: meta with presumed dtype: string
2025-05-15 22:22:22,706 [INFO    ] [cost_model.projections.event_log.create_initial_event_log:56] Initial event log created with 2 records. Dtypes:
event_id       string[python]
event_time     datetime64[ns]
employee_id    string[python]
event_type     string[python]
value_num             Float64
value_json     string[python]
meta           string[python]
dtype: object
2025-05-15 22:22:22,706 [INFO    ] [cost_model.projections.cli.main:108] Starting projection engine...
2025-05-15 22:22:22,706 [INFO    ] [cost_model.config.loaders.load_yaml_config:71] Attempting to load configuration from: config/dev_tiny.yaml
2025-05-15 22:22:22,715 [INFO    ] [cost_model.config.loaders.load_yaml_config:89] Successfully loaded configuration from config/dev_tiny.yaml
2025-05-15 22:22:22,715 [INFO    ] [cost_model.config.params.parse_config:114] Parsed global parameters: namespace(seed=42, start_year=2025, num_years=5, new_hire_rate=0.17, term_rate=0.15, comp_raise_pct=0.03, cola_pct=0.02, new_hire_termination_rate=0.25, compensation=namespace(cola_pct=0.02, comp_raise_pct=0.03))
2025-05-15 22:22:22,715 [INFO    ] [cost_model.config.params.parse_config:115] Parsed plan rules: namespace(eligibility=namespace(min_age=21, min_service_months=0), onboarding_bump=namespace(enabled=True, method='sample_plus_rate', rate=0.05), auto_enrollment=namespace(enabled=False, window_days=90, proactive_enrollment_probability=0.0, proactive_rate_range=[0.0, 0.0], default_rate=0.0, re_enroll_existing=False, opt_down_target_rate=0.0, increase_to_match_rate=0.0, increase_high_rate=0.0, outcome_distribution=namespace(prob_opt_out=0.0, prob_stay_default=1.0, prob_opt_down=0.0, prob_increase_to_match=0.0, prob_increase_high=0.0)), auto_increase=namespace(enabled=False, increase_rate=0.0, cap_rate=0.0), employer_match=namespace(tiers=[namespace(match_rate=0.0, cap_deferral_pct=0.0)], dollar_cap=0.0), employer_nec=namespace(rate=0.01), irs_limits=namespace(_2024=namespace(compensation_limit=345000, deferral_limit=23000, catchup_limit=7500, catchup_eligibility_age=50)), behavioral_params=namespace(voluntary_enrollment_rate=0.2, voluntary_default_deferral=0.05, voluntary_window_days=180, voluntary_change_probability=0.1, prob_increase_given_change=0.4, prob_decrease_given_change=0.3, prob_stop_given_change=0.05, voluntary_increase_amount=0.01, voluntary_decrease_amount=0.01), contributions=namespace(enabled=True), eligibility_events=namespace(milestone_months=[], milestone_years=[], event_type_map={}))
2025-05-15 22:22:22,715 [ERROR   ] [cost_model.projections.cli.main:149] An unexpected error occurred during the projection run: Missing required columns in snapshot: {'cola_pct', 'term_rate', 'new_hire_termination_rate', 'comp_raise_pct', 'cfg'}
Traceback (most recent call last):
  File "/Users/nicholasamaral/Library/Mobile Documents/com~apple~CloudDocs/Development/cost-model/cost_model/projections/cli.py", line 110, in main
    run_projection_engine(config_ns, initial_snapshot, initial_event_log)
  File "/Users/nicholasamaral/Library/Mobile Documents/com~apple~CloudDocs/Development/cost-model/cost_model/projections/runner/orchestrator.py", line 38, in run_projection_engine
    params = initialize(config_ns, initial_snapshot, initial_log)
  File "/Users/nicholasamaral/Library/Mobile Documents/com~apple~CloudDocs/Development/cost-model/cost_model/projections/runner/init.py", line 63, in initialize
    raise ValueError(f"Missing required columns in snapshot: {missing_cols}")
ValueError: Missing required columns in snapshot: {'cola_pct', 'term_rate', 'new_hire_termination_rate', 'comp_raise_pct', 'cfg'}
